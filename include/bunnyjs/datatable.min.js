function getActionObject(t){var a=t.getAttribute("action"),e=a.split("."),n=e[0],r=null;if(void 0===e[1])r=window[n];else{var i=e[1];try{r=window[n][i].bind(window[n])}catch(t){}}if(void 0===r)throw new Error('Bunny Error: Model search action specified in action="'+a+'" attribute not found');return r}function initObjectExtensions(t,a){var e=Object.keys(t);e.forEach(function(e){0===e.indexOf("init")&&t[e](a)})}function pushToElementProperty(t,a,e){void 0===t[a]&&(t[a]=[]),t[a].push(e)}function pushCallbackToElement(t,a,e){pushToElementProperty(t,"__bunny_"+a+"_callbacks",e)}function callElementCallbacks(t,a,e){var n=t["__bunny_"+a+"_callbacks"];void 0!==n&&!function(){var t=function t(a){var r=e(n[a]);r instanceof Promise?r.then(function(e){e!==!1&&a>0&&t(a-1)}):r!==!1&&a>0&&t(a-1)};t(n.length-1)}()}var DataTableConfig={tagName:"datatable",attrUrl:"url",attrTemplate:"template",tagNamePagination:"pagination",tagNameStats:"stats",classNameAsc:"arrow-down",classNameDesc:"arrow-up",perPage:15,paginationLimit:7,ajaxHeaders:[]},DataTableUI={Config:DataTableConfig,Template:Template,getSearchInput:function(t,a){return t.querySelector('[name="'+a+'"]')||!1},getColumn:function(t,a){return this.getTable(t).querySelector('[pid="'+a+'"]')||!1},getAllSearchInputs:function(t){return t.querySelectorAll("input, select")},getTable:function(t){return t.getElementsByTagName("table")[0]},getOrderCells:function(t){return t.querySelectorAll("th[pid]")},getPagination:function(t){return t.getElementsByTagName(this.Config.tagNamePagination)[0]},getStats:function(t){return t.getElementsByTagName(this.Config.tagNameStats)[0]},removeRows:function(t){for(var a=this.getTable(t),e=a.rows.length,n=e-1;n>0;n--)a.deleteRow(n)},insertRows:function(t,a,e){this.Template.insertAll(e,a,this.getTable(t))},clearAllColumnsOrder:function(t){var a=this,e=t.parentNode.querySelectorAll("th");[].forEach.call(e,function(t){t.classList.remove(a.Config.classNameAsc),t.classList.remove(a.Config.classNameDesc)})},setColumnAsc:function(t){this.clearAllColumnsOrder(t),t.classList.add(this.Config.classNameAsc)},setColumnDesc:function(t){this.clearAllColumnsOrder(t),t.classList.add(this.Config.classNameDesc)},isColumnAsc:function(t){return t.classList.contains(this.Config.classNameAsc)},isColumnDesc:function(t){return t.classList.contains(this.Config.classNameDesc)}},DataTable={Config:DataTableConfig,UI:DataTableUI,Ajax:Ajax,Pagination:Pagination,init:function(t){if(void 0!==t.__bunny_datatable)return!1;t.__bunny_datatable={};var a=BunnyURL.getParam("page");void 0===a&&(a=1),this.addEvents(t),initObjectExtensions(this,t);var e=this.getOrderDataFromURL(t);if(void 0!==e.order_by){var n=this.UI.getColumn(t,e.order_by);"asc"===e.order_rule?this.UI.setColumnAsc(n):this.UI.setColumnDesc(n)}return this.changePage(t,a,Object.assign(this.getSearchDataFromURL(t),e)),!0},initAll:function(){var t=this;ready(function(){[].forEach.call(document.getElementsByTagName(t.Config.tagName),function(a){t.init(a)})})},isInitiated:function(t){return void 0!==t.__bunny_datatable},getTemplateId:function(t){return t.getAttribute(this.Config.attrTemplate)},getAjaxUrl:function(t){return t.getAttribute(this.Config.attrUrl)},getAjaxHeaders:function(){var t={};return DataTableConfig.ajaxHeaders.forEach(function(a){var e=a.split(": ");t[e[0]]=e[1]}),t},addAjaxHeader:function(t){this.Config.ajaxHeaders.push(t)},getSearchData:function(t){var a=this.UI.getAllSearchInputs(t),e={};return[].forEach.call(a,function(t){t&&t.value.length>0&&(e[t.name]=t.value)}),e},getSearchDataFromURL:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,e=BunnyURL.getParams(a),n={};for(var r in e)if("page"!==r){var i=this.UI.getSearchInput(t,r);i&&(i.value=e[r],n[r]=e[r])}return n},getOrderData:function(t){for(var a={},e=this.UI.getOrderCells(t),n=0;n<e.length;n++){var r=e[n];if(this.UI.isColumnAsc(r)){a.order_by=r.getAttribute("pid"),a.order_rule="asc";break}if(this.UI.isColumnDesc(r)){a.order_by=r.getAttribute("pid"),a.order_rule="desc";break}}return a},getOrderDataFromURL:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,e=BunnyURL.getParam("order_by",a),n={};return e&&(n.order_by=e,n.order_rule=BunnyURL.getParam("order_rule",a)),n},getDataUrl:function(t,a){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.Pagination.addPageParamToUrl(this.getAjaxUrl(t),a);for(var r in e)n+="&"+r+"="+e[r];return n},addEvents:function(t){var a=this,e=this.UI.getAllSearchInputs(t);[].forEach.call(e,function(e){addEventOnce(e,"input",function(){a.update(t,a.getDataUrl(t,1,Object.assign(a.getSearchData(t),a.getOrderData(t))))})});var n=this.UI.getOrderCells(t);[].forEach.call(n,function(e){e.addEventListener("click",function(){a.UI.isColumnAsc(e)?(a.UI.setColumnDesc(e),a.update(t,a.getDataUrl(t,a.getPage(),Object.assign(a.getSearchData(t),a.getOrderData(t))))):(a.UI.setColumnAsc(e),a.update(t,a.getDataUrl(t,a.getPage(),Object.assign(a.getSearchData(t),a.getOrderData(t)))))})})},attachPaginationEventHandlers:function(t){var a=this,e=this.UI.getPagination(t);this.Pagination.onItemClick(e,function(e,n){a.changePage(t,e)})},callHandlers:function(t,a){callElementCallbacks(t,"datatable_redraw",function(t){t(a)})},callBeforeHandlers:function(t,a){callElementCallbacks(t,"datatable_before_redraw",function(t){t(a)})},onBeforeRedraw:function(t,a){pushCallbackToElement(t,"datatable_before_redraw",a)},onRedraw:function(t,a){pushCallbackToElement(t,"datatable_redraw",a)},fetchData:function(t,a){var e=this;return new Promise(function(t){e.Ajax.get(a,function(a){a=JSON.parse(a),t(a)},{},e.getAjaxHeaders())})},changePage:function(t,a){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===e&&(e=this.getSearchData(t)),this.update(t,this.getDataUrl(t,a,e))},getPage:function(){var t=BunnyURL.getParam("page");return t?t:1},updateURL:function(t,a){var e=window.location.href,n=BunnyURL.getParam("page",a);n>1?e=BunnyURL.setParam("page",n):BunnyURL.hasParam("page",e)&&(e=BunnyURL.removeParam("page",e));var r=BunnyURL.getParam("order_by",a);r&&(e=BunnyURL.setParam("order_by",r,e),e=BunnyURL.setParam("order_rule",BunnyURL.getParam("order_rule",a),e));var i=this.UI.getAllSearchInputs(t);[].forEach.call(i,function(t){var n=t.name,r=BunnyURL.getParam(n,a);r&&""!==r?e=BunnyURL.setParam(n,r,e):BunnyURL.hasParam(n,e)&&(e=BunnyURL.removeParam(n,e))}),e!==window.location.href&&window.history.replaceState("","",e)},update:function(t,a){var e=this;this.callBeforeHandlers(t),this.UI.getTable(t).classList.remove("in"),this.fetchData(t,a).then(function(n){var r=e.UI.getPagination(t),i=e.Pagination;i.initOrUpdate(r,n),e.attachPaginationEventHandlers(t);var o=e.UI.getStats(t);void 0!==o&&(o.textContent=i.getStats(r)),e.UI.removeRows(t),e.UI.insertRows(t,n.data,e.getTemplateId(t)),e.UI.getTable(t).classList.add("in"),e.updateURL(t,a),e.callHandlers(t,n)})}};DataTable.initAll();